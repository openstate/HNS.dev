<?php

$GLOBALS['strftimeNames'] = array(
	'en' => array(
		'fullMonthNames'  => array(1 => 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'),
		'shortMonthNames' => array(1 => 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'),
		'fullDayNames'    => array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'),
		'shortDayNames'   => array('Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat')
	),
	'nl' => array(
		'fullMonthNames'  => array(1 => 'januari', 'februari', 'maart', 'april', 'mei', 'juni', 'juli', 'augustus', 'september', 'oktober', 'november', 'december'),
		'shortMonthNames' => array(1 => 'jan', 'feb', 'mrt', 'apr', 'mei', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'),
		'fullDayNames'    => array('zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag'),
		'shortDayNames'   => array('zo', 'ma', 'di', 'wo', 'do', 'vr', 'za')
	),
	'de' => array(
		'fullMonthNames'  => array(1 => 'Januar', 'Februar', 'März', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'),
		'shortMonthNames' => array(1 => 'Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'),
		'fullDayNames'    => array('Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'),
		'shortDayNames'   => array('So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa')
	),
	'fr' => array(
		'fullMonthNames'  => array(1 => 'janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'),
		'shortMonthNames' => array(1 => 'janv', 'févr', 'mars', 'avr', 'mai', 'juin', 'juil', 'août', 'sept', 'oct', 'nov', 'dec'),
		'fullDayNames'    => array('dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'),
		'shortDayNames'   => array('dim', 'lun', 'mar', 'mer', 'jeu', 'ven', 'sam')
	),
	'it' => array(
		'fullMonthNames'  => array(1 => 'gennaio', 'febbraio', 'marzo', 'aprile', 'maggio', 'giugno', 'luglio', 'agosto', 'settembre', 'ottobre', 'novembre', 'dicembre'),
		'shortMonthNames' => array(1 => 'gen', 'feb', 'mar', 'apr', 'mag', 'giu', 'lug', 'ago', 'set', 'ott', 'nov', 'dic'),
		'fullDayNames'    => array('domenica', 'lunedì', 'martedì', 'mercoledì', 'giovedì', 'venerdì', 'sabato'),
		'shortDayNames'   => array('dom', 'lun', 'mar', 'mer', 'gio', 'ven', 'sab')
	),
	'es' => array(
		'fullMonthNames'  => array(1 => 'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'),
		'shortMonthNames' => array(1 => 'ene', 'feb', 'mar', 'abr', 'may', 'jun', 'jul', 'ago', 'sep', 'oct', 'nov', 'dic'),
		'fullDayNames'    => array('domingo', 'lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado'),
		'shortDayNames'   => array('dom', 'lun', 'mar', 'mié', 'jue', 'vie', 'sáb')
	),
	'pt' => array( // ucfirst or not?
		'fullMonthNames'  => array(1 => 'janeiro', 'fevereiro', 'março', 'abril', 'maio', 'junho', 'julho', 'agosto', 'setembro', 'outubro', 'novembro', 'dezembro'),
		'shortMonthNames' => array(1 => 'jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'),
		'fullDayNames'    => array('domingo', 'segunda-feira', 'terça-feira', 'quarta-feira', 'quinta-feira', 'sexta-feira', 'sábado'),
		'shortDayNames'   => array('dom', 'seg', 'ter', 'qua', 'qui', 'sex', 'sáb')
	),
	'da' => array(
		'fullMonthNames'  => array(1 => 'januar', 'februar', 'marts', 'april', 'maj', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'december'),
		'shortMonthNames' => array(1 => 'jan.', 'feb.', 'mrs.', 'apr.', 'maj', 'juni', 'juli', 'aug.', 'sept.', 'okt.', 'nov.', 'dec.'),
		'fullDayNames'    => array('søndag', 'mandag', 'tirsdag', 'onsdag', 'torsdag', 'fredag', 'lørdag'),
		'shortDayNames'   => array('søn', 'man', 'tir', 'ons', 'tor', 'fre', 'lør')
	),
	'sv' => array(
		'fullMonthNames'  => array(1 => 'januari', 'februari', 'mars', 'april', 'maj', 'juni', 'juli', 'augusti', 'september', 'oktober', 'november', 'december'),
		'shortMonthNames' => array(1 => 'jan', 'feb', 'mar', 'apr', 'maj', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'dec'),
		'fullDayNames'    => array('söndag', 'måndag', 'tisdag', 'onsdag', 'torsdag', 'fredag', 'lördag'),
		'shortDayNames'   => array('sön', 'mån', 'tis', 'ons', 'tor', 'fre', 'lör')
	),
	'no' => array(
		'fullMonthNames'  => array(1 => 'januar', 'februar', 'mars', 'april', 'mai', 'juni', 'juli', 'august', 'september', 'oktober', 'november', 'desember'),
		'shortMonthNames' => array(1 => 'jan', 'feb', 'mar', 'apr', 'mai', 'jun', 'jul', 'aug', 'sep', 'okt', 'nov', 'des'),
		'fullDayNames'    => array('søndag', 'mandag', 'tirsdag', 'onsdag', 'torsdag', 'fredag', 'lørdag'),
		'shortDayNames'   => array('søn', 'man', 'tir', 'ons', 'tor', 'fre', 'lør')
	),
	'fi' => array(
		'fullMonthNames'  => array(1 => 'tammikuu', 'helmikuu', 'maaliskuu', 'huhtikuu', 'toukokuu', 'kesäkuu', 'heinäkuu', 'elokuu', 'syyskuu', 'lokakuu', 'marraskuu', 'joulukuu'),
		'shortMonthNames' => array(1 => 'tammi', 'helmi', 'maalis', 'huhti', 'touko', 'kesä', 'heinä', 'elo', 'syys', 'loka', 'marras', 'joulu'),
		'fullDayNames'    => array('sunnuntai', 'maanantai', 'tiistai', 'keskiviikko', 'torstai', 'perjantai', 'lauantai'),
		'shortDayNames'   => array('su', 'ma', 'ti', 'ke', 'to', 'pe', 'la')
	),
);

function strftime2($format, $timestamp = false, $locale = 'en') {
	if (!isset($GLOBALS['strftimeNames'][$locale]))
		$locale = 'en';
	$strftimeNames = $GLOBALS['strftimeNames'][$locale];	
	if (is_int($timestamp)) {
		$timestampObj = new DateTime(date('c', $timestamp));
	} else if (is_string($timestamp)) {	
		$timestampObj = new DateTime($timestamp);
		$timestamp = date_format($timestampObj, 'U');
	} else {
		$timestampObj = new DateTime();	
	}
		
	$format = reformat($format);

	$_loc_from = array();
	$_loc_to   = array();
	if (strpos($format, '%B') !== false) {
		$_loc_from[] = '%B';
		$_loc_to[]	 = preg_replace('/(.)/','\\\${1}', $strftimeNames['fullMonthNames'][(int)date('n', $timestamp)]);
	}
	if (strpos($format, '%b') !== false) {
		$_loc_from[] = '%b';
		$_loc_to[]	 = preg_replace('/(.)/','\\\${1}', $strftimeNames['shortMonthNames'][(int)date('n', $timestamp)]);
	}
	if (strpos($format, '%A') !== false) {
		$_loc_from[] = '%A';
		$_loc_to[]	 = preg_replace('/(.)/','\\\${1}', $strftimeNames['fullDayNames'][(int)date('w', $timestamp)]);
	}
	if (strpos($format, '%a') !== false) {
		$_loc_from[] = '%a';
		$_loc_to[]	 = preg_replace('/(.)/','\\\${1}', $strftimeNames['shortDayNames'][(int)date('w', $timestamp)]);
	}		
	$format = str_replace($_loc_from, $_loc_to, $format);	
	return date_format($timestampObj, $format);
	//return strftime(str_replace($_loc_from, $_loc_to, $format), $timestamp);
}

function reformat($format) {
	$conversion = array(
		'%a' => '%a',		//short dat
		'%A' => '%A', 		//long day
		'%b' => '%b', 		//short month
		'%B' => '%B', 		// long month
		'%c' => 'd/m/Y', 	//~date format current locale
		'%C' => '', 		//!century, no conversion possible
		'%d' => 'd', 		//day of the month (decimal with zero)
		'%D' => 'm/d/Y', 	// month/day/year notation
		'%e' => 'j',		//~day of the month (decimal, !space padded)
		'%g' => '',			//!
		'%G' => '',			//!
		'%h' => '%b',		//short month
		'%H' => 'H',		//Hour 24
		'%I' => 'h',		//hour 12
		'%j' => 'z', 		//~day of the year, not correct 1-366 => 0-365
		'%m' => 'm',		//month (decimal with zero)
		'%M' => 'i',		//minute
		'%n' => "\n",		//newline
		'%p' => 'a',		//am/pm
		'%r' => 'H:i:s',	//time in 24 hours format
		'%R' => 'h:i:s',	//time in 12 hour format
		'%S' => 's',		//seconds
		'%t' => "\t",		//tab character
		'%T' => 'H:i:s',	//current time
		'%u' => 'N',		//weekday [1,7], 1 = Monday
		'%U' => 'W',		//~week number
		'%V' => 'W',		//~week number
		'%W' => 'W',		//week number
		'%w' => 'N',		//~weekday
		'%x' => 'd/m/Y', 	//~date display current locale
		'%X' => 'H:i:s',	//~time display current locale
		'%y' => 'y',		//year without century
		'%Y' => 'Y',		//year with century
		'%Z' => 'e',		//timezone identifier
		'%z' => 'e',		//timezone identifier
		'%%' => '%',		//literal %
	);
	
	$from = array_keys($conversion);
	$to = array_values($conversion);
	
	return str_replace($from, $to, $format);
}

?>